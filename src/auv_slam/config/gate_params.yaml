# Location: src/auv_slam/config/gate_params.yaml
# Gate Navigation Parameters - Safe Depth Control

gate_detector_node:
  ros__parameters:
    # HSV RANGES - Tuned for Gazebo
    red_lower1: [0, 100, 100]
    red_upper1: [10, 255, 255]
    red_lower2: [170, 100, 100]
    red_upper2: [180, 255, 255]
    
    green_lower: [40, 100, 100]
    green_upper: [80, 255, 255]
    
    orange_lower: [10, 120, 120]
    orange_upper: [25, 255, 255]
    
    # =========================================================================
    # CRITICAL: Filtering parameters to reject flares
    # =========================================================================
    # Gate posts are 25cm wide blocks (LARGE)
    # Flares are 1.6cm diameter (THIN)
    min_area_strict: 500           # Gate blocks are large (>500 pixels)
    min_area_relaxed: 300          # Relaxed for far distances
    min_stripe_width_pixels: 20    # CRITICAL: Reject thin flares (<20px)
    min_aspect_ratio: 1.5          # Taller than wide
    max_aspect_ratio: 8.0          # But not extremely thin like flares
    aspect_threshold: 0.8          # Minimum for stripe validation
    
    gate_width_meters: 1.5
    publish_debug: true

gate_navigator_node:
  ros__parameters:
    # =========================================================================
    # SAFE DEPTH CONTROL
    # =========================================================================
    # Pool floor: -1.6m
    # NEVER GO DEEPER THAN -1.3m
    target_depth: -1.0          # Safe mission depth (1.0m below surface)
    
    # Depth Control Tuning
    depth_correction_gain: 1.0  # Moderate gain
    depth_deadband: 0.15        # Ignore small errors
    max_depth_limit: -1.35      # HARD LIMIT - never exceed this
    
    # Vertical speed limits
    max_vertical_speed: 0.4     # Limit vertical movement to 0.4 m/s
    
    # Navigation Speeds
    search_forward_speed: 0.4
    search_rotation_speed: 0.15
    
    # Approach (Far -> 3m)
    approach_start_distance: 8.0
    approach_stop_distance: 3.0
    approach_speed: 0.5
    approach_yaw_gain: 0.8
    
    # Alignment (at 3m)
    alignment_distance: 3.0
    alignment_threshold: 0.08
    alignment_max_time: 20.0
    alignment_yaw_gain: 2.5
    
    # Final Approach (3m -> 1.2m)
    final_approach_start: 3.0
    final_approach_speed: 0.4
    final_approach_threshold: 0.15
    
    # Passing
    passing_trigger_distance: 1.2
    passing_speed: 1.0
    gate_width: 1.5
    
    # Flare Avoidance
    flare_critical_distance: 2.5
    flare_lateral_speed: 0.4
    flare_forward_speed: 0.3